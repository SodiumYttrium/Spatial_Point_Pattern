{
  "hash": "558d7c758c6ffbe7f60c072413ef4f47",
  "result": {
    "markdown": "---\ntitle: \"Estimation of Second Order Properties\"\nauthor: \"Natalie Young\"\ndate: \"2023-08-23\"\ncategories: [code, analysis]\nbibliography: ../../references.bib\nlink-citations: TRUE\ndraft: true\n---\n\n# Estimating the K-function\nRecall the definition of the K-function:\n$$\nK(t) = \\frac{E[N_0(t)]}{\\lambda}\n$$\nIn small samples, estimation of $K(t)$ would be more straightforward than that of $\\lambda_2(t)$ or $\\rho(t)$.\nWhile $K(t)$ and $\\lambda_2(t)$ are both related to the distribution of inter-event\ndistances, $K(t)$ can be estimated without deciding how much to smooth the empirical distribution.\n\nSometimes we may use random thinning (i.e. retaining or discarding each event using\nmutually independent Bernoulli trials) to reduce our sample size, and $K(t)$ is\ninvariant under this process. This is due to the ratio of $E[N_0(t)]$ and $\\lambda$\nbeing unchanged.\n\nAn obvious estimator for $\\lambda$ is $\\hat{\\lambda} = n/|A|$, the number of observed\nevents divided by the area. As for $E[N_0(t)]$, the expected number of further events\nwithin distance $t$ of an arbitrary event, we can use the following estimator:\n$$\n\\tilde{E}(t) = \\frac{1}{n} \\displaystyle \\sum_{i=1}^n \\sum_{j \\ne i} I(r_{ij} \\leq t)\n$$\nwhere $I$ is the indicator function and $r_{ij} = ||x_i - x_j||$. However, this estimator\nis negatively biased due to *edge-effects*, where events outside of the observed region\nmay interact with those within the region. In this case, some events that lie within\ndistance $t$ may be unobserved as they lie outside the region.\n\n# Edge-correction\nWe will now explore the method [@Ripley] to correct this bias. Let $w(x,r)$ be the\nproportion of the circumference of the circle, with centre $x$ and radius $r$, that\nlies in the observed region $A$. Define $w_{ij} = w(x_i, ||x_i-x_j||)$, i.e. for\na circle centred at $x_i$ with $x_j$ lying on its circumference, the proportion of\nthe circumference inside $A$. For any stationary isotropic process, $w_{ij}$ is the\nprobability that an event is observed, given it is distance $r_{ij}=||x_i-x_j||$\naway from event $x_i$. In general $w_{ij}\\ne w_{ji}$.\n\nAn unbiased estimator for $E[N_0(t)]$ is thus:\n$$\n\\hat{E}(t)=\\frac{1}{n}\\displaystyle \\sum_{i=1}^n\\sum_{j \\ne i}\\frac{1}{w_{ij}}I(r_{ij} \\leq t)\n$$\nReplacing the unknown intensity $\\lambda$ by $(n-1)/|A|$, we obtain an estimator\nfor $K(t)$:\n$$\n\\hat{K}(t)= \\frac{|A|}{n(n-1)} \\displaystyle \\sum_{i=1}^n\\sum_{j \\ne i}\\frac{1}{w_{ij}}I(r_{ij} \\leq t)\n$$\nThis is the form that Diggle used in the book. Ripley's estimator used $n^2$ instead\nof $n(n-1)$ in the denominator, but for large $n$, the difference is negligible.\n\nThe variance of $\\hat{K}(t)$ can be used in a similar way to the simulation envelopes we\nused in previous CSR tests. There are several ways to estimate the sample variance,\nproposed by various people, but in particular, assuming $A$ is a rectangular region,\nLotwick and Silverman’s result is [@LS]:\n$$\nv_{LS}(t) = \\frac{1}{n(n-1)}\\{2b(t)-a_1(t) + (n-2)a_2(t)\\}\n$$\nwhere, denoting the perimeter of $A$ as $P$,\n$$\n\\begin{align}\nb(t) &= \\frac{\\pi t^2}{|A|} (1 - \\frac{\\pi t^2}{|A|}) + \\frac{1}{|A|^2} (1.0716Pt^2 \n+ 2.2375t^4), \\\\\na_1(t) &= \\frac{1}{|A|^2}(0.21Pt^3 + 1.3t^4), \\\\\na_2(t) &= \\frac{1}{|A|^3}(0.24Pt^5 + 2.62t^6) \\\\\n\\end{align}\n$$\nThe formulae have been modified by Diggle to account for the modified formula of\n$\\hat{K}(t)$. They are valid for $t$ at most the length of the shorter side of $A$.\n\n# Estimation using R\n\n::: {.cell}\n\n:::\n\n\nRStudio has the built-in function `Kest` which estimates the K function and the variance, \nbased on several edge-correction methods. Here we will use Ripley's isotropic correction \nand Lotwick and Silverman’s variance under homogeneity, as they were discussed above. The following graphs\nwill plot $\\hat{K}(t)$ of the data, the theoretical $K(t)$ from a homogeneous Poisson process, and the envelopes\nthat are $K(t)$ plus or minus 2 standard errors.\n\n\n::: {.cell}\n\n:::\n\n\n## Japanese black pines\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nWe see that $\\hat{K}(t)$ lies close to $K(t)$, and remains inside the envelopes.\nCSR is evident, which agrees with our previous tests of CSR.\n\n## Redwood\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nWith the majority proportion of $\\hat{K}(t)$ lying above 2 standard errors of $K(t)$,\nit is clear that the data is aggregated, since there are more further events expected\naround an arbitrary event compared to a homogeneous Poisson process.\n\n## Cells\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nFor distances under 0.15, the expected number of further events around an arbitrary event\nis less than under CSR. This is a typical behaviour of regular patterns, and this agrees\nwith our previous tests of CSR.\n\n## Beilschmiedia pendula (Lauraceae)\nSince the built-in function is not suitable for handling patterns with over 3000\ndata points, I am only performing the test on the top left corner of the region,\nwhich is a $100 \\times 100$ square containing 136 points:\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nThe clear excess of expected further events provides strong evidence against CSR.\nWe have established from previous CSR tests that the pattern of all 3604 trees are\naggregated just like the redwood saplings, and this subset behaves the same.\n\n# Multivariate process\nThe estimation of $K_{12}(t)$ for a bivariate pattern follows the same idea as $K(t)$,\nbut the distances measured would be between pairs of events of different types.\nFor the $i$th type 1 event and the $j$th type 2 event, let $u_{ij}$ be the distance between\nthem, and $w_{ij}$ be defined based on them. The numbers of type 1 and 2 events are\n$n_1$ and $n_2$ respectively. Then a weighted average of estimated $\\hat{K}_{12}(t)$ would be:\n\n$$\n\\hat{K}_{12}(t) = \\frac{|A|}{n_1 n_2}\\displaystyle \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_2}\nw_{ij}^* I(u_{ij} \\le t)\n$$\nwhere\n$$\nw_{ij}^* = \\frac{n_1 w_{ij} + n_2 w_{ji}}{n_1 + n_2}\n$$\nLotwick and Silverman [@LS] also gave a formula for the variance of the bivariate case.\nFor $b(t)$, $a_1(t)$ and $a_2(t)$ as defined above, alongside $c=n_2/(n_1+n_2)$,\nfor 2 independent homogeneous Poisson processes,\n$$\nVar\\{\\hat{K}_{12}(t)\\} = \\frac{|A|^2}{n_1 n_2}[b(t) - 2c(1-c)a_1(t) + \\{(n_1-1)c^2\n+ (n_2-1)(1-c)^2\\}a_2(t)]\n$$\n\nFrom the Barro Colorado Island dataset [@bciweb; @Condit; @bci], I have obtained 3 species of trees: *Acalypha diversifolia*, *Cecropia insignis* and *Cupania seemannii*. Using the `Kmulti` built-in\nfunction, $\\hat{K}_{12}(t)$ between each pair of these species can be estimated.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n:::\n\n\n## Acalypha diversifolia & Cecropia insignis\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Cecropia insignis & Cupania seemannii\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Cupania seemannii & Acalypha diversifolia\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nThe first 2 pairs of species exhibit strong aggregation, while the third pair exhibits\nregularity. ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}